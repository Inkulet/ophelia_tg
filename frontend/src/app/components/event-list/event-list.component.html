<div class="section-container">
  <h2 class="section-title">Мероприятия</h2>

  <p class="state-text" *ngIf="loading">Загружаем мероприятия...</p>
  <p class="state-text error" *ngIf="!loading && error">{{ error }}</p>
  <p class="state-text" *ngIf="!loading && !error && events.length === 0">
    Пока нет запланированных мероприятий.
  </p>

  <div class="events-grid" *ngIf="!loading && !error && events.length > 0">
    <article class="event-card" *ngFor="let event of events">
      <div class="media-wrap" *ngIf="event.mediaURL">
        <video
          *ngIf="isVideoMedia(event.mediaURL); else eventImage"
          [src]="mediaUrl(event.mediaURL)"
          controls
          preload="metadata"
        ></video>
        <ng-template #eventImage>
          <img [src]="mediaUrl(event.mediaURL)" [alt]="event.title" loading="lazy" />
        </ng-template>
      </div>

      <h3 class="event-title">{{ event.title }}</h3>
      <p class="event-date">Дата: {{ event.date | date:'dd.MM.yyyy' }}</p>
      <p class="event-date" *ngIf="event.time">Время: {{ event.time }}</p>
      <p class="event-date" *ngIf="event.location">Локация: {{ event.location }}</p>
      <p class="event-description">{{ event.description }}</p>
      <p class="event-capacity">Участники: {{ participantsLabel(event) }}</p>

      <button
        class="register-btn"
        [disabled]="isFull(event) || actionState[event.id]?.loading"
        (click)="register(event)"
      >
        <ng-container *ngIf="actionState[event.id]?.loading; else registerText">Записываем...</ng-container>
        <ng-template #registerText>
          {{ isFull(event) ? 'Мест нет' : 'Записаться' }}
        </ng-template>
      </button>

      <p class="action-message success" *ngIf="actionState[event.id]?.success">
        {{ actionState[event.id]?.success }}
      </p>
      <p class="action-message error" *ngIf="actionState[event.id]?.error">
        {{ actionState[event.id]?.error }}
      </p>
    </article>
  </div>
</div>
